<div class="container my-5" data-controller="glightbox">
  <div class="row">
    <div class="col-lg-8">
      <% if @vehicle.cover_image.attached? %>
        <div class="cover-image-section mb-4">
          <%= image_tag @vehicle.cover_image, class: 'cover-img w-100 rounded-2' %>
        </div>
        <% else %>
          <%= image_tag 'https://as2.ftcdn.net/v2/jpg/00/58/87/17/1000_F_58871737_dryKwXlGDoaJRv8qlpEvvoSBXQ55yP9R.jpg', style: "width: 100%;", class: "rounded-2" %>
      <% end %>

      <div id="vehicleCarousel" class="carousel slide mt-5 mb-5" data-bs-ride="carousel">
        <div class="carousel-inner">
          <% @vehicle.vehicle_images.each_slice(3).with_index do |images, index| %>
            <div class="carousel-item <%= 'active' if index.zero? %>">
              <div class="row gallery">
                <% images.each do |image| %>
                  <div class="col">
                    <%= link_to image_tag(image, class: "d-block rounded-2 w-100 vehicle-gallery-images"), image, data: { lightbox: "vehicle-gallery" } %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#vehicleCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#vehicleCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

      <div class="description mb-4">
        <h4 class="fw-bold">Description</h4>
        <p class="fs-5"><%= @vehicle.description.html_safe %></p>
      </div>

      <div class="p-3 rounded-3 mb-4">
        <h3 class="mb-3 fw-bold">Car Overview</h3>
        <div class="d-flex"><p class="fs-5"><i class="bi bi-fuel-pump fs-3 me-3"></i><span class="me-4 fw-bold">Fule Type:</span><%= @vehicle.fuel_type %></p></div>
        <div class="d-flex"><p class="fs-5"><i class="bi bi-calendar fs-3 me-3"></i><span class="me-4 fw-bold">Registration Number:</span><%= @vehicle.registration_number %></p></div>
        <div class="d-flex"><p class="fs-5"><i class="bi bi-car-front-fill fs-3 me-3"></i><span class="me-4 fw-bold">Vehicle Type:</span><%= @vehicle.vehicle_type.try(:name) %></p></div>
       <div class="d-flex"><p class="fs-5"><i class="bi bi-currency-dollar fs-3 me-3"></i><span class="me-4 fw-bold">Base price:</span><%= number_to_currency(@vehicle.base_price, unit: "Rs. ") %></p></div>
       <div class="d-flex"><p class="fs-5"><i class="bi bi-speedometer2 fs-3 me-3"></i><span class="me-4 fw-bold">Price Per KM:</span><%= number_to_currency(@vehicle.price_per_km, unit: "Rs. ") %></p></div>
       <div class="d-flex"><p class="fs-5"><i class="bi bi-speedometer2 fs-3 me-3"></i><span class="me-4 fw-bold">Price Per Hour:</span><%= number_to_currency(@vehicle.price_per_hour, unit: "Rs. ") %></p></div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="bg-light p-3 rounded-3 mb-4">
        <div class="text-center mx-3 my-3">
          <% if user_signed_in? %>
            <!-- Contact Owner Button trigger modal -->
            <button type="button" class="btn btn-success text-light w-100" data-bs-toggle="modal" data-bs-target="#contactOwnerModal">
              <i class="bi bi-ticket-detailed-fill"></i> Owner Detail
            </button>
            <button type="button" class="btn btn-outline-primary w-100 mt-2 shadow-sm" data-bs-toggle="modal" data-bs-target="#bookingModal">
              <i class="bi bi-calendar-check me-2"></i> Book Now
            </button>
          <% else %>
            <%= link_to new_user_session_path, class: "btn btn-success w-100" do %>
              <i class="bi bi-ticket-detailed-fill"></i> Owner Detail
            <% end %>
            <%= link_to  new_user_session_path, class: "btn btn-outline-primary w-100 mt-2" do %>
              <i class="bi bi-calendar-check me-2"></i> Book Now
            <% end %>
          <% end %> 
        </div>
      </div>
      <div class="card shadow">
        <div class="card-body">
          <h2 class="text-center">Contact Owner</h2>
          <%= form_with url: send_message_vehicle_path(@vehicle), method: :post do |f| %>
            <div class="form-group mt-2 mb-2">
              <%= f.label :name, class: "form-label" %>
              <%= f.text_field :name, class: "form-control", required: true %>
            </div>
            <div class="form-group mt-2 mb-2">
              <%= f.label :email, class: "form-label" %>
              <%= f.email_field :email, class: "form-control", required: true %>
            </div>
            <div class="form-group mt-2 mb-2">
              <%= f.label :phone_number, class: "form-label" %>
              <%= f.text_field :phone_number, class: "form-control", required: true %>
            </div>
            <%= f.submit "Send Message", class: "btn btn-danger text-light rounded-0 w-100 mt-2" %>
          <% end %>
        </div>
      </div>


      <div class="modal fade" id="contactOwnerModal" tabindex="-1" aria-labelledby="contactOwnerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="contactOwnerModalLabel">Contact Owner</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-lg-3">
                  <% if user_signed_in? && current_user.profile_image.present? %>
                    <%= image_tag profile_image %>
                  <% else %>
                    <%= image_tag "https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg?t=st=1719568989~exp=1719572589~hmac=183092f16506fb3b2916086787d898deab3e32efb5fc2f44b5e735a9e9b9f866&w=826", style: 'width: 100px;'  %>  
                  <% end %>
                </div>
                <div class="col-lg-9 mt-3">
                  <p><strong>Name :</strong> <%= @owner.name %></p>
                  <p><strong>Email :</strong> <%= @owner.email %></p>
                  <p><strong>Contact Number :</strong> <%= @owner.phone_number %></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="book_car_button mt-4">
        <% if user_signed_in? %>
          <!-- Modal -->
          <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header bg-success text-white">
                  <h5 class="modal-title" id="bookingModalLabel">Book Vehicle</h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <%= render 'bookings/form', booking: Booking.new(vehicle_id: @vehicle.id) %>
                </div>
              </div>
            </div>
          </div>
        <% end %>  
      </div>
    </div>
  </div>
 <!-- Related Vehicles Section -->  
</div>
<% if @related_vehicles.present? %>
  <div class="related-vehicles mt-5">
    <h3 class="fw-bold">Related Vehicles</h3>
    <div class="row">
      <% @related_vehicles.each do |vehicle| %>
        <div class="col-md-3">
          <div class="card mb-4">
            <%= link_to vehicle_path(vehicle), class: 'text-decoration-none' do %>
              <div class="position-relative">
                <% if vehicle.cover_image.attached? %>
                  <%= image_tag vehicle.cover_image, class: "card-img-top related-vehicle-img" %>
                <% else %>
                  <%= image_tag 'sedan01.jpeg', class: "card-img-top related-vehicle-img" %>
                <% end %>
                <div class="overlay">
                  <span class="favorite-icon"><i class="bi bi-heart"></i></span>
                </div>
              </div>
              <div class="card-body">
                <h4 class="card-title text-dark"><%= vehicle.name %></h4>
                <div class="d-flex justify-content-between mt-5">
                  <div class="d-block text-center fs-5 text-dark">
                    <i class="bi bi-fuel-pump"></i>
                    <div><%= vehicle.fuel_type %></div>
                  </div>
                  <div class="d-block text-center fs-5 text-dark">
                    <i class="bi bi-calendar"></i>
                    <div><%= vehicle.registration_number %></div>
                  </div>
                  <div class="d-block text-center fs-5 text-dark">
                    <i class="bi bi-car-front-fill"></i>
                    <div><%= vehicle.vehicle_type.try(:name) %></div>
                  </div>
                </div>
                <hr>
                <div class="d-flex justify-content-between">
                  <div>
                    <span class="text-muted"><%= number_to_currency(vehicle.base_price) %></span>
                  </div>
                  <div>
                    <%= link_to vehicle_path(vehicle), class: "text-decoration-none text-danger" do %>
                      View Details <i class="bi bi-arrow-up-right"></i>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>


